## **üåç **Installing Nginx Ingress Controller Via Helm****

---

### **üöÄ **1. Install Nginx Ingress Controller****

**First add Nginx Ingress Controller's repository to Helm by running:**

```bash
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
```

**First add its repository:**
```bash
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update
```

**Expected output:**
```text
...
...
Update Complete. ‚éàHappy Helming!‚éà
```

**Following command installs the Nginx Ingress Controller from the stable charts repository, names the Helm release nginx-ingress, and sets the publishService parameter to true.**
```bash
helm install nginx-ingress ingress-nginx/ingress-nginx --set controller.publishService.enabled=true
```

**Expected output of the install command:**

```text
Output
NAME: nginx-ingress
LAST DEPLOYED: Mon Sep  2 11:40:28 2024
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
...
```

**Run this command to watch `-w` the Load Balancer become available:**

```bash
kubectl --namespace default get services -o wide -w nginx-ingress-ingress-nginx-controller
```

**After some time has passed, MetalLB will assign a External IP address to the Service automatically for newly created Load Balancer:**

**Expected output:**
```text
NAME                                     TYPE           CLUSTER-IP    EXTERNAL-IP     PORT(S)                      AGE     SELECTOR
nginx-ingress-ingress-nginx-controller   LoadBalancer   10.43.8.169   172.16.100.11   80:31375/TCP,443:30567/TCP   5h55m   app.kubernetes.io/component=controller,app.kubernetes.io/instance=nginx-ingress,app.kubernetes.io/name=ingress-nginx
```

**When it is successful it means we are ready for our next steps.**

---

### **üîÑ **2. Nginx as a Reverse Proxy on Cloud-VM****

It's only purpose is to forward http and https traffic for our domain `example.com` to the LoadBalancer service `nginx-ingress-ingress-nginx-controller`.

We are going to use CloudVM's Public IP, as master-01 and worker-01 do not have their own dedicated public IPs. Instead, they are behind a NAT (Network Address Translation) on your ISP-provided router. This means the public IP visible to the outside world is the router's IP, not the IP of master-01 or worker-01. Cloud-VM is our Entry point and this is the IP address we have assigned in our DNS provider (Cloudflare) settings.

### **First create a Nginx reverse proxy on cloud-vm:**

```bash
dnf install nginx -y
```

**Verify that the directory `/etc/nginx/sites-available` exists. If it does not, create it using the following command:**
```bash
sudo mkdir -p /etc/nginx/sites-available
```

**Next, create a file named `default` using the following command:**
```bash
sudo tee /etc/nginx/sites-available/default <<EOF
# NGINX reverse proxy configuration on cloud-vm

server {
    listen 80;
    server_name example.com *.example.com;

    location / {
        proxy_pass http://172.16.100.11; # # Forward to LoadBalancer service `nginx-ingress-ingress-nginx-controller`.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

server {
    listen 443 ssl;
    server_name example.com *.example.com;

    # These directives will simply forward the SSL traffic to the Ingress Controller without terminating it
    location / {
        proxy_pass http://172.16.100.11; # Forward to LoadBalancer service `nginx-ingress-ingress-nginx-controller`.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
EOF
```

**Then verify and reload nginx:**

```bash
sudo nginx -t
sudo systemctl nginx reload 
```

**Create an Ingress resource to expose the Kuard application:**

```bash
cat <<EOF > kuard-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kuard-k8s-ingress
spec:
  ingressClassName: nginx
  rules:
    - host: "kuard1.example.com"
      http:
        paths:
          - path: "/"
            pathType: Prefix
            backend:
              service:
                name: kuard-k8s-first
                port:
                  number: 80
EOF
```

**Roll out:**
```bash
kubectl create -f kuard-ingress.yaml
```

and Check in your browsers incognito mode: http://kuard1.example.com for the

---